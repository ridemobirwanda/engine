<!DOCTYPE html>
<html>
<head>
    <title>Chat Settings Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .setting { padding: 10px; margin: 10px 0; background: #f9f9f9; border-left: 4px solid #4CAF50; }
        .setting.error { border-left-color: #f44336; }
        .title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #333; }
        .status { display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status.ok { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">üß™ Chat Widgets Settings Test</div>
        <div id="results">Loading...</div>
    </div>

    <script>
        async function testAPI() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Test API settings endpoint
                const response = await fetch('http://localhost:3001/api/settings');
                
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }
                
                const settings = await response.json();
                
                // Find chat-related settings
                const tawkEnabled = settings.find(s => s.key === 'tawk_enabled');
                const tawkPropertyId = settings.find(s => s.key === 'tawk_property_id');
                const tawkWidgetId = settings.find(s => s.key === 'tawk_widget_id');
                const whatsappEnabled = settings.find(s => s.key === 'whatsapp_enabled');
                const whatsappNumber = settings.find(s => s.key === 'whatsapp_number');
                
                // Check if values are properly parsed
                const tawkOk = typeof tawkEnabled?.value === 'string' && tawkEnabled.value === 'true';
                const whatsappOk = typeof whatsappEnabled?.value === 'string' && whatsappEnabled.value === 'true';
                
                resultsDiv.innerHTML = `
                    <div class="setting ${tawkOk ? '' : 'error'}">
                        <strong>üéØ Tawk.to Settings</strong>
                        <span class="status ${tawkOk ? 'ok' : 'error'}">${tawkOk ? 'OK' : 'ERROR'}</span>
                        <div style="margin-top: 10px;">
                            <div><strong>Enabled:</strong> ${JSON.stringify(tawkEnabled?.value)} ${typeof tawkEnabled?.value === 'string' ? '‚úÖ' : '‚ùå (should be string)'}</div>
                            <div><strong>Property ID:</strong> ${JSON.stringify(tawkPropertyId?.value)}</div>
                            <div><strong>Widget ID:</strong> ${JSON.stringify(tawkWidgetId?.value)}</div>
                        </div>
                    </div>
                    
                    <div class="setting ${whatsappOk ? '' : 'error'}">
                        <strong>üì± WhatsApp Settings</strong>
                        <span class="status ${whatsappOk ? 'ok' : 'error'}">${whatsappOk ? 'OK' : 'ERROR'}</span>
                        <div style="margin-top: 10px;">
                            <div><strong>Enabled:</strong> ${JSON.stringify(whatsappEnabled?.value)} ${typeof whatsappEnabled?.value === 'string' ? '‚úÖ' : '‚ùå (should be string)'}</div>
                            <div><strong>Number:</strong> ${JSON.stringify(whatsappNumber?.value)}</div>
                        </div>
                    </div>
                    
                    <div class="setting">
                        <strong>üìä API Status</strong>
                        <span class="status ok">WORKING</span>
                        <div style="margin-top: 10px;">
                            <div><strong>Total Settings:</strong> ${settings.length}</div>
                            <div><strong>JSON Parsing:</strong> ${tawkOk && whatsappOk ? '‚úÖ Working correctly' : '‚ùå Issues detected'}</div>
                        </div>
                    </div>
                    
                    <div class="setting">
                        <strong>‚úÖ Next Steps:</strong>
                        <ol>
                            <li>Open your website: <a href="http://localhost:21201/" target="_blank">http://localhost:21201/</a></li>
                            <li>Look for chat widgets in bottom-right corner</li>
                            <li>Wait 3-5 seconds for Tawk.to to load</li>
                            <li>You should see both WhatsApp (green) and Tawk.to (blue/purple)</li>
                        </ol>
                    </div>
                    
                    <details style="margin-top: 20px;">
                        <summary style="cursor: pointer; font-weight: bold;">üîç Full Settings Response</summary>
                        <pre>${JSON.stringify(settings, null, 2)}</pre>
                    </details>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="setting error">
                        <strong>‚ùå API Error</strong>
                        <span class="status error">FAILED</span>
                        <div style="margin-top: 10px;">
                            <div><strong>Error:</strong> ${error.message}</div>
                            <div><strong>Make sure:</strong></div>
                            <ul>
                                <li>API server is running on port 3001</li>
                                <li>Run: <code>npm run api</code></li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }
        
        // Run test when page loads
        testAPI();
    </script>
</body>
</html>




